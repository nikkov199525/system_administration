# Анализ системных сбоев 


## 01. Недостаточно прав
Симптом   — скрипт не может создать файл  
Ключевая строка   (logs/01.strace)
17:09:07.046074 openat(AT_FDCWD</home/hlebushek/strace-lab>, "/tmp/secret-dir/data.txt", O_WRONLY|O_CREAT|O_TRUNC, 0666) = -1 EACCES (Отказано в доступе) <0.000122>
Причина   — каталог `/tmp/secret-dir` создан с правами 0555 → нет бита записи  
  Фикс   — `chmod 755 /tmp/secret-dir`

## 02. Нет такого файла/каталога
  Ключевая строка   (logs/02.strace)
09:07:11.455946 openat(AT_FDCWD</home/hlebushek/system_administration/lab6>, "/opt/app/config/settings.yaml", O_RDONLY) = -1 ENOENT (Нет такого файла или каталога) <0.000122>
 
Причина   — файл или один из сегментов пути не существует  
Фикс   — создать файл/директории или поправить путь

## 03. DNS timeout
Ключевая картина   (logs/03.strace)  
Много циклов запросов к 127.0.0.53:53 и в конце процесса таймаут 5 сек  
Причина   — отсутствует запись для `example.local`  
Фикс   — добавить в `/etc/hosts`: `127.0.0.1 example.local`

## 04. Порт закрыт
Ключевая строка   (logs/04.strace)
17:09:08.111169 connect(3<TCP:[51209]>, {sa_family=AF_INET, sin_port=htons(9999), sin_addr=inet_addr("127.0.0.1")}, 16) = -1 ECONNREFUSED (В соединении отказано) <0.000366>
Причина   — на 127.0.0.1:9999 нет слушающего процесса  
Фикс   — `nc -l -p 9999`

## 05. Блокировка файла
Ключевая строка   (logs/05.strace)
6055  09:07:14.155013 flock(3</tmp/shared.lock>, LOCK_EX) = 0 <0.000223>
Причина   — файл уже заблокирован первым экземпляром  
Фикс   — завершить первый процесс

## 06. Медленный fsync
Ключевые строки   (logs/06.strace)
17:09:09.531362 write(3, "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"..., 67108864) = 67108864 <0.125049>
17:09:09.681211 fsync(3)                = 0 <0.000064>

Причина   — принудительная синхронизация на носитель  
Фикс   — убрать `fsync`, писать в tmpfs, O_DIRECT и т.д.

## 07. Ошибка в дочернем процессе
Ключевая строка   (logs/07.5845 — лог ребёнка)
17:09:09.807733 newfstatat(AT_FDCWD</home/hlebushek/strace-lab>, "/nonexistent", ...) = -1 ENOENT
17:09:09.808226 chdir("/nonexistent")   = -1 ENOENT (Нет такого файла или каталога)
Причина   — ошибка происходит после fork, без `-ff` её не видно  
Фикс   — поправить путь или оставить текущий каталог
## 08. Запрещено политикой / правами
  Ключевая строка   (logs/08.strace)
openat(AT_FDCWD</home/hlebushek/strace-lab>, "/etc/shadow", O_RDONLY|O_CLOEXEC) = -1 EACCES (Отказано в доступе)
Причина   — либо AppArmor-профиль, либо обычные права файла 0000  
Фикс   — отключить профиль или добавить правило allow
